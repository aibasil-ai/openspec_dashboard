## Context

目前 Dashboard 僅在使用者手動開啟/切換專案時更新資料，外部編輯器或其他程序修改 OpenSpec 檔案後，畫面不會即時反映，導致資訊與實際檔案狀態脫鉤。本次變更需在既有資料解析流程上新增「檔案更新偵測 + 自動同步」機制，並保留使用者當前閱讀上下文。

## Goals / Non-Goals

**Goals:**
- 建立可監聽專案檔案更新的機制，觸發自動同步。
- 在同步過程提供可視化狀態（同步中/完成/失敗）。
- 同步後保留頁籤與選取內容，避免干擾使用流程。
- 防止高頻更新造成重複重整與效能問題。

**Non-Goals:**
- 不提供跨裝置即時同步。
- 不改動 OpenSpec 檔案格式與目錄規則。
- 不在本次變更加入複雜衝突合併邏輯。

## Decisions

### Decision: 以「輪詢 + 快照比較」作為跨模式一致策略
- **選擇**：對檔案集合定期比對 `path + lastModified` 指紋（可寫模式與 fallback 模式皆可用）。
- **原因**：Browser API 對原生 file watch 支援不一致，輪詢策略較穩定可落地。
- **替代方案**：依賴原生 file watch（平台相依高）；僅手動 refresh（不符合需求）。

### Decision: 同步流程使用單一 `refreshProjectData()` 管線
- **選擇**：將偵測更新後重整流程統一導向同一資料管線，確保統計、清單、細節一致更新。
- **原因**：避免多處重整邏輯分叉造成狀態不一致。
- **替代方案**：各區塊局部刷新（維護成本高且易漏更新）。

### Decision: 加入去抖動視窗避免重整風暴
- **選擇**：對更新事件以固定窗口（例如 500~1000ms）合併處理。
- **原因**：可在連續檔案變動情境下降低過度重算。
- **替代方案**：每次事件都重整（易造成卡頓）。

### Decision: 同步失敗採「保留舊資料 + 錯誤提示」
- **選擇**：同步失敗時不清空目前資料，只顯示同步失敗訊息並等待下一次重試。
- **原因**：可維持可讀內容，避免使用者看到空白畫面。
- **替代方案**：失敗即清空重載（體驗差）。

## Risks / Trade-offs

- [Risk] 輪詢可能增加 CPU 使用率 → Mitigation：調整輪詢間隔並只監控必要路徑。
- [Risk] `lastModified` 解析差異造成誤判 → Mitigation：結合檔案數量與內容摘要做二次判斷。
- [Risk] 同步期間 UI 閃動 → Mitigation：保留現有資料直到新資料完成解析再一次性替換。
- [Trade-off] 去抖動會帶來些微同步延遲 → Mitigation：將窗口設為短時且可配置。

## Migration Plan

1. 建立檔案指紋產生器與比對函式。
2. 新增輪詢觸發器與去抖動排程。
3. 將刷新入口整合到共用 `refreshProjectData()`。
4. 串接同步狀態 UI（同步中/完成/失敗）。
5. 驗證頁籤與選取上下文保留策略。
6. 執行效能測試並調整輪詢頻率。

Rollback：若自動刷新造成穩定性問題，可關閉輪詢觸發器，保留手動開啟/切換刷新模式。

## Open Questions

- 輪詢間隔是否需要暴露為使用者可調整設定？
- fallback 模式是否需提供「手動立即同步」按鈕作為補充？
